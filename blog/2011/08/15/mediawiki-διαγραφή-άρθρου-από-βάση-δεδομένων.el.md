<!-- -
Title: MediaWiki: Διαγραφή άρθρου από τη βάση δεδομένων
Description: Οδηγός διαγραφής άρθρου από τη βάση δεδομένων του MediaWiki
Author: Marios Zindilis
First Published: 2011-08-15
- -->

MediaWiki: Διαγραφή άρθρου από τη βάση δεδομένων
================================================

Υπάρχουν περιπτώσεις στο MediaWiki που ένα άρθρο δεν μπορεί να διαγραφεί μέσω της συνηθισμένης διεπαφής, οπότε χρειάζεται σκάλισμα της βάσης δεδομένων. Αυτός ο οδηγός περιγράφει τον τρόπο.

Προτού προχωρήσετε σε οποιαδήποτε παρέμβαση στη βάση δεδομένων σας, οπωσδήποτε πρέπει να κρατήσετε ένα <strong>αντίγραφο ασφαλείας</strong> ολόκληρης της βάσης. Επίσης, αν το Wiki σας έχει έντονη δραστηριότητα, μπορείτε προσωρινά να αποτρέψετε οποιεσδήποτε αλλαγές στις σελίδες, προσθέτωντας μια γραμμή στο αρχείο LocalSettings.php: <code>$wgReadOnly = 'Το Wiki είναι προσωρινά μη διαθέσιμο για επεξεργασία.';</code>. 

<h3>Δομή της βάσης δεδομένων</h3>
Η δομή της βάσης δεδομένων του MediaWiki υπάρχει στην τεκμηρίωση, στο άρθρο <a href="http://www.mediawiki.org/wiki/Manual:Database_layout">Database Layout</a>. Για το κάθε άρθρο που εμφανίζεται στο Wiki εμπλέκονται τουλάχιστον τρεις από τους πίνακες της βάσης:
<ol><li>Στον πίνακα <strong>page</strong> αποθηκεύεται μια λίστα με τους τίτλους όλων των άρθρων. Όταν χρειάζεται να εμφανιστεί ένα άρθρο, γίνεται αναζήτηση σε αυτόν τον πίνακα με βάση τον τίτλο, και ανακτάται η τιμή του πεδίου <code>page_latest</code>.</li>
<li>Με την τιμή <code>page_latest</code> γίνεται αναζήτηση στον πίνακα <strong>revision</strong>. Σ' αυτόν τον πίνακα αποθηκεύονται μερικά <em>μεταδεδομένα</em> (δηλαδή όχι καθαυτό το περιεχόμενο) για κάθε αλλαγή που γίνεται στο Wiki. Για να εμφανιστεί ένα άρθρο, από αυτόν τον πίνακα ανακτούνται οι τιμές <code>rev_id</code> και <code>rev_text_id</code>.</li>
<li>Τέλος, με την τιμή <code>rev_text_id</code> που βρέθηκε στο προηγούμενο βήμα, γίνεται αναζήτηση στον πίνακα <strong>text</strong>, και ανακτάται η τιμή του πεδίου <code>old_text</code>, η οποία αποτελεί και το περιεχόμενο του άρθρου. Ο πίνακας <strong>text</strong> αποθηκεύει ολόκληρο το περιεχόμενο από κάθε αναθεώρηση κάθε άρθρου του Wiki.</li>
</ol>
<h3>Διαγραφή των καταχωρήσεων</h3>
Το πρώτο βήμα είναι να αναζητήσετε τον τίτλο του άρθρου στον πίνακα <strong>page</strong>, στη στήλη <code>page_title</code>. Οι τίτλοι αποθηκεύονται με τα διαστήματα αλλαγμένα σε κάτω παύλες (underscore) και με τους χαρακτήρες ειδικά διαμορφωμένους σε δεκαεξαδικούς χαρακτήρες UTF-8, αν περιέχεται στον τίτλο χαρακτήρας άλλος από τα Αγγλικά. Δυστυχώς, δεν έχω βρει εύκολο τρόπο να κάνετε τη μετατροπή. Μπορείτε να αναζητήσετε στο διαδίκτυο για βοηθήματα, όπως για παράδειγμα αυτός ο <a href="http://rocky.uta.edu/doran/charsets/charsets.cgi?map=marc2unicode&table=8">πίνακας μετατροπής χαρακτήρων</a>. Εναλλακτικά, αν χρησιμοποιείτε κάποιο πρόγραμμα όπως το PhpMyAdmin, μπορείτε να εξάγετε ολόκληρο τον πίνακα σε CSV, να τον ανοίξετε με ένα πρόγραμμα όπως το OpenOffice Calc και να δείτε τα περιεχόμενά του κανονικά.

Όταν βρείτε τον τίτλο που θέλετε, σημειώστε την τιμή του πεδίου <code>page_id</code> που αντιστοιχεί στον τίτλο, και διαγράψτε αυτή τη γραμμή από τον πίνακα, εκτελώντας κάτι σαν <code>DELETE FROM my_database.mw_page WHERE mw_page.page_id = 1234</code>. Από αυτή τη στιγμή και μετά, η σελίδα δεν είναι διαθέσιμη στο Wiki, το περιεχόμενό της όμως παραμένει στη βάση δεδομένων.

Για να εξαφανιστεί εντελώς η σελίδα από τη βάση δεδομένων και να μην μείνουν «σπασμένες» αναφορές σ' αυτήν, θα πρέπει να διαγράψετε και όλες τις αναθεωρήσεις της από τον πίνακα <strong>revision</strong>, καθώς και όλα τα αλλαγμένα κείμενα από τον πίνακα <strong>text</strong>.

Μπορείτε να δείτε όλες τις αναθεωρήσεις που θα διαγραφούν, εκτελώντας κάτι σαν <code>SELECT * FROM mw_revision WHERE mw_revision.rev_page = 1234</code>, αλλά προτού τις διαγράψετε, θα χρειαστείτε τα αντίστοιχα <code>rev_text_id</code>, τα οποία θα τα χρησιμοποιήσετε αργότερα. Για να τα δείτε, εκτελέστε <code>SELECT rev_text_id FROM my_database.mw_revision WHERE mw_revision.rev_page = 1234</code>. Κρατήστε κάπου ξεχωριστά αυτό το αποτέλεσμα, θα σας χρειαστεί μετά. Τώρα μπορείτε να διαγράψετε τις αναθεωρήσεις, εκτελώντας κάτι σαν <code>DELETE FROM my_database.mw_revision WHERE mw_revision.rev_page = 1234</code>.

Τέλος, από τον πίνακα <strong>text</strong> θα πρέπει να διαγράψετε τα κείμενα των παλιών αναθεωρήσεων της σελίδας. Το πεδίο <code>old_id</code> αυτού του πίνακα, είναι ίδιο με το <code>rev_text_id</code> που κρατήσατε προηγουμένως. Μπορείτε λοιπόν να διαγράψετε ένα ένα τα κείμενα, εκτελώντας επανηλειμμένα κάτι σαν <code>DELETE FROM my_database.mw_text WHERE mw_text.old_id = 100</code>, αλλάζωντας το «100» σε ό,τι αντιστοιχεί στα δικά σας δεδομένα.
